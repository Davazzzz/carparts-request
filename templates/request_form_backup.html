<!DOCTYPE html>
<html lang="{{ 'en' if language == 'en' else 'es' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if language == 'en' %}Junkyard Runner Form{% else %}Formulario de Junkyard Runner{% endif %}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            padding-top: 90px;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.95em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 0.95em;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: scale(1.02);
        }

        .submit-btn:active {
            transform: scale(0.98);
        }

        .back-link {
            text-align: center;
            margin-top: 20px;
        }

        .back-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .info-banner {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #1565c0;
        }

        /* Table of Contents Styles */
        .table-of-contents {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .table-of-contents.hidden {
            opacity: 0;
            transform: translateY(-100%);
            pointer-events: none;
        }

        .toc-title {
            display: none;
        }

        .toc-grid {
            display: flex;
            flex-direction: row;
            gap: 10px;
            justify-content: center;
            align-items: center;
            flex-wrap: nowrap;
            overflow-x: auto;
        }

        .toc-item {
            background: rgba(255,255,255,0.2);
            padding: 12px 20px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9em;
            font-weight: 600;
            border: 2px solid transparent;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .toc-item:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
            border-color: white;
        }

        /* Scroll Indicator */
        .scroll-indicator {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            animation: bounce 2s infinite;
            transition: all 0.3s ease;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
        }

        .scroll-indicator.hidden {
            opacity: 0;
            transform: translateX(-50%) translateY(100px);
            pointer-events: none;
        }

        .scroll-indicator:hover {
            transform: translateX(-50%) scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            40% {
                transform: translateX(-50%) translateY(-10px);
            }
            60% {
                transform: translateX(-50%) translateY(-5px);
            }
        }

        @media (max-width: 768px) {
            .table-of-contents {
                padding: 12px 10px;
            }

            .toc-grid {
                gap: 6px;
            }

            .toc-item {
                padding: 10px 12px;
                font-size: 0.75em;
            }

            body {
                padding-top: 80px;
            }
        }

        @media (max-width: 600px) {
            body {
                padding-top: 75px;
            }

            .container {
                padding: 30px 20px;
            }

            h1 {
                font-size: 1.6em;
            }

            .toc-item {
                padding: 8px 10px;
                font-size: 0.7em;
            }

            .scroll-indicator {
                font-size: 0.95em;
                padding: 12px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="font-size: 2.5em; color: #667eea;">üèÉ Junkyard Runner Form</h1>
        <p class="subtitle" style="font-size: 1.05em; margin-bottom: 25px; color: #e65100; font-weight: 600;">
            {% if language == 'en' %}
                No guarantee your part will be there - it's hit or miss, but I'll check. Just give me time.
            {% else %}
                No hay garant√≠a de que tu pieza est√© ah√≠ - depende de disponibilidad, pero la buscar√©. Solo dame tiempo.
            {% endif %}
        </p>

        <!-- Table of Contents -->
        <div class="table-of-contents" id="toc">
            <div class="toc-title">
                {% if language == 'en' %}üìç Quick Navigation{% else %}üìç Navegaci√≥n R√°pida{% endif %}
            </div>
            <div class="toc-grid">
                <div class="toc-item" onclick="scrollToSection('how-it-works')">
                    {% if language == 'en' %}üìã How It Works{% else %}üìã C√≥mo Funciona{% endif %}
                </div>
                <div class="toc-item" onclick="scrollToSection('form-start')">
                    {% if language == 'en' %}‚úçÔ∏è Fill Form{% else %}‚úçÔ∏è Llenar Formulario{% endif %}
                </div>
                <div class="toc-item" onclick="scrollToSection('contact-info')">
                    {% if language == 'en' %}üìû Text Instead{% else %}üìû Texto{% endif %}
                </div>
                <div class="toc-item" onclick="scrollToSection('pricing-section')">
                    {% if language == 'en' %}üí∞ Pricing{% else %}üí∞ Precios{% endif %}
                </div>
                <div class="toc-item" onclick="scrollToSection('warranty-section')">
                    {% if language == 'en' %}üõ°Ô∏è Warranty{% else %}üõ°Ô∏è Garant√≠a{% endif %}
                </div>
                <div class="toc-item" onclick="scrollToSection('secure-part-section')">
                    {% if language == 'en' %}üîí Secure Part{% else %}üîí Asegurar Pieza{% endif %}
                </div>
                <div class="toc-item" onclick="scrollToSection('submit-section')">
                    {% if language == 'en' %}üì§ Submit{% else %}üì§ Enviar{% endif %}
                </div>
            </div>
        </div>

        <!-- Process Info - MOVED TO TOP -->
        <div id="how-it-works" class="info-banner" style="border-left: 5px solid #667eea; background: #e3f2fd;">
            <h3 style="color: #1565c0; font-size: 1.4em; font-weight: 800; margin-bottom: 12px;">
                {% if language == 'en' %}üìã HOW IT WORKS{% else %}üìã C√ìMO FUNCIONA{% endif %}
            </h3>
            <div style="color: #1565c0; font-weight: 600; line-height: 1.8;">
                <p style="margin-bottom: 15px; font-size: 1.05em; font-weight: 800;">
                    {% if language == 'en' %}
                        Fill out the form below with as much information as possible. Make sure to select your preferred way to secure the part.
                    {% else %}
                        Completa el formulario a continuaci√≥n con la mayor informaci√≥n posible. Aseg√∫rate de seleccionar tu forma preferida de asegurar la pieza.
                    {% endif %}
                </p>
                <p style="margin-bottom: 15px; font-size: 1.05em;">
                    {% if language == 'en' %}Provide me:{% else %}Proporci√≥name:{% endif %}
                </p>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    {% if language == 'en' %}
                        <li>Year / Make / Model / Color</li>
                        <li>Part needed</li>
                        <li>If you know which junkyard has it and what year models are compatible, let me know ‚Äî it gives me a better shot at finding your part</li>
                        <li>Phone number</li>
                    {% else %}
                        <li>A√±o / Marca / Modelo / Color</li>
                        <li>Pieza necesaria</li>
                        <li>Si sabes qu√© deshuesadero lo tiene y qu√© modelos de a√±o son compatibles, h√°zmelo saber ‚Äî me da una mejor oportunidad de encontrar tu pieza</li>
                        <li>N√∫mero de tel√©fono</li>
                    {% endif %}
                </ul>
                <p style="font-size: 1.05em;">
                    {% if language == 'en' %}
                        I'll check the yard and send photos/videos + a price estimate.
                    {% else %}
                        Revisar√© el deshuesadero y enviar√© fotos/videos + un estimado de precio.
                    {% endif %}
                </p>
            </div>
        </div>

        <form id="requestForm">
            <!-- Customer Info -->
            <div id="form-start" class="form-group">
                <label>{% if language == 'en' %}Name from Facebook Messenger *{% else %}Nombre de Facebook Messenger *{% endif %}</label>
                <input type="text" id="customer_name" required>
            </div>

            <div class="form-group">
                <label>{% if language == 'en' %}üìû Phone Number *{% else %}üìû N√∫mero de Tel√©fono *{% endif %}</label>
                <input type="tel" id="customer_phone" placeholder="(323) 555-1234" required>
                <small style="color: #666; display: block; margin-top: 5px;">
                    {% if language == 'en' %}
                        üí° Required for communication and updates
                    {% else %}
                        üí° Requerido para comunicaci√≥n y actualizaciones
                    {% endif %}
                </small>
            </div>

            <!-- Vehicle Info -->
            <h3 style="color: #667eea; margin: 30px 0 15px;">
                {% if language == 'en' %}Vehicle Information{% else %}Informaci√≥n del Veh√≠culo{% endif %}
            </h3>

            <div class="form-group">
                <label>{% if language == 'en' %}Year *{% else %}A√±o *{% endif %}</label>
                <input type="text" id="vehicle_year" required placeholder="2015">
            </div>

            <div class="form-group">
                <label>{% if language == 'en' %}Make *{% else %}Marca *{% endif %}</label>
                <input type="text" id="vehicle_make" required placeholder="{% if language == 'en' %}Toyota, Honda, Ford...{% else %}Toyota, Honda, Ford...{% endif %}">
            </div>

            <div class="form-group">
                <label>{% if language == 'en' %}Model *{% else %}Modelo *{% endif %}</label>
                <input type="text" id="vehicle_model" required placeholder="{% if language == 'en' %}Camry, Civic, F-150...{% else %}Camry, Civic, F-150...{% endif %}">
            </div>

            <div class="form-group">
                <label>{% if language == 'en' %}Color{% else %}Color{% endif %}</label>
                <input type="text" id="vehicle_color" placeholder="{% if language == 'en' %}Black, White, Silver...{% else %}Negro, Blanco, Plateado...{% endif %}">
                <label style="display: flex; align-items: center; gap: 10px; margin-top: 10px; cursor: pointer;">
                    <input type="checkbox" id="color_doesnt_matter" style="width: 20px; height: 20px;">
                    <span>{% if language == 'en' %}Color doesn't matter{% else %}El color no importa{% endif %}</span>
                </label>
            </div>

            <!-- Part Info -->
            <h3 style="color: #667eea; margin: 30px 0 15px;">
                {% if language == 'en' %}Part/s Needed{% else %}Pieza/s Necesaria/s{% endif %}
            </h3>

            <!-- NEW: Part Price Search Section - MOVED ABOVE INPUT -->
            <div style="background: white; padding: 30px; border-radius: 12px; margin: 30px 0; border: 3px solid #667eea;">
                <h2 style="color: #667eea; margin-bottom: 10px; text-align: center; font-size: 1.8em;">
                    {% if language == 'en' %}üí∞ HOW TO PROVIDE PART INFORMATION{% else %}üí∞ C√ìMO PROPORCIONAR INFORMACI√ìN DE PIEZAS{% endif %}
                </h2>
                <p style="text-align: center; color: #666; font-weight: 600; margin-bottom: 20px; font-size: 1.05em;">
                    {% if language == 'en' %}‚ö†Ô∏è Choose one of the 3 options below{% else %}‚ö†Ô∏è Elige una de las 3 opciones abajo{% endif %}
                </p>

                <!-- OPTION 1: BEST -->
                <div style="margin-bottom: 20px;">
                    <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; border-left: 5px solid #28a745;">
                        <h3 style="color: #28a745; margin-bottom: 10px; font-size: 1.3em;">
                            {% if language == 'en' %}‚≠ê OPTION 1 ‚Äì Go to Pick Your Part Website (BEST!){% else %}‚≠ê OPCI√ìN 1 ‚Äì Ve al Sitio Web de Pick Your Part (¬°MEJOR!){% endif %}
                        </h3>
                        <ul style="margin-left: 20px; line-height: 1.8; margin-bottom: 15px;">
                            {% if language == 'en' %}
                                <li>Visit pyp.com/prices to find exact part names and prices</li>
                                <li>Copy the exact part name/s from their website</li>
                                <li>Paste them in the "Part/s Name" field below</li>
                                <li><strong>Fastest response time!</strong></li>
                            {% else %}
                                <li>Visita pyp.com/prices para encontrar nombres y precios exactos</li>
                                <li>Copia el/los nombre/s exacto/s de su sitio web</li>
                                <li>P√©galos en el campo "Nombre de la/s Pieza/s" abajo</li>
                                <li><strong>¬°Tiempo de respuesta m√°s r√°pido!</strong></li>
                            {% endif %}
                        </ul>
                        <a href="https://pyp.com/prices" target="_blank"
                           style="display: inline-block; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 15px 30px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 1.1em;">
                            üåê {% if language == 'en' %}Visit pyp.com/prices{% else %}Visita pyp.com/prices{% endif %}
                        </a>
                        <p style="font-size: 0.9em; color: #666; font-style: italic; margin-top: 12px;">
                            {% if language == 'en' %}
                                ‚ö†Ô∏è <strong>Note:</strong> The junkyard sells each piece individually. Make sure to list all the pieces you need!
                            {% else %}
                                ‚ö†Ô∏è <strong>Nota:</strong> El desarmadero vende cada pieza individualmente. ¬°Aseg√∫rate de listar todas las piezas que necesitas!
                            {% endif %}
                        </p>
                    </div>
                </div>

                <!-- OPTION 2: GOOD -->
                <div style="margin-bottom: 20px;">
                    <div style="background: #fff3e0; padding: 20px; border-radius: 8px; border-left: 5px solid #ff9800;">
                        <h3 style="color: #f57c00; margin-bottom: 10px; font-size: 1.3em;">
                            {% if language == 'en' %}‚úÖ OPTION 2 ‚Äì Search Junkyard Parts Here (Good){% else %}‚úÖ OPCI√ìN 2 ‚Äì Buscar Piezas del Desarmadero Aqu√≠ (Buena){% endif %}
                        </h3>
                        <p style="font-size: 0.95em; color: #666; margin-bottom: 12px; font-style: italic;">
                            {% if language == 'en' %}
                                üí° All prices below come from pyp.com/prices
                            {% else %}
                                üí° Todos los precios abajo vienen de pyp.com/prices
                            {% endif %}
                        </p>
                        <input type="text" id="junkyard-search" placeholder="{% if language == 'en' %}Type to search for exact or similar parts...{% else %}Escribe para buscar piezas exactas o similares...{% endif %}"
                               oninput="searchJunkyardParts(this.value)"
                               style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; margin-bottom: 10px;">
                        <small style="color: #666; display: block; margin-bottom: 10px;">
                            {% if language == 'en' %}
                                üí° Search for exact or similar wording to what you need (e.g., "bumper", "headlight", "door")
                            {% else %}
                                üí° Busca palabras exactas o similares a lo que necesitas (ej., "parachoques", "faro", "puerta")
                            {% endif %}
                        </small>

                        <!-- Search results dropdown -->
                        <div id="junkyard-suggestions" style="max-height: 300px; overflow-y: auto; border: 2px solid #667eea; border-radius: 8px; margin-top: 5px; display: none; background: white;"></div>

                        <!-- Selected parts display -->
                        <div id="selected-junkyard-parts" style="margin-top: 15px;"></div>
                    </div>
                </div>

                <!-- OPTION 3: SLOWER -->
                <div>
                    <div style="background: #ffebee; padding: 20px; border-radius: 8px; border-left: 5px solid #f44336;">
                        <h3 style="color: #c62828; margin-bottom: 10px; font-size: 1.3em;">
                            {% if language == 'en' %}‚è±Ô∏è OPTION 3 ‚Äì Just Give Part Name/s (Slower Response){% else %}‚è±Ô∏è OPCI√ìN 3 ‚Äì Solo Da Nombre/s de Pieza/s (Respuesta M√°s Lenta){% endif %}
                        </h3>
                        <ul style="margin-left: 20px; line-height: 1.8; margin-bottom: 15px;">
                            {% if language == 'en' %}
                                <li>Simply enter part name/s in the field below</li>
                                <li>I'll search for prices myself or ask at the junkyard</li>
                                <li><strong>Slower response time</strong> - quote will take longer to prepare</li>
                            {% else %}
                                <li>Simplemente ingresa el/los nombre/s de pieza/s en el campo abajo</li>
                                <li>Buscar√© los precios yo mismo o preguntar√© en el desarmadero</li>
                                <li><strong>Tiempo de respuesta m√°s lento</strong> - la cotizaci√≥n tomar√° m√°s tiempo en prepararse</li>
                            {% endif %}
                        </ul>

                        <!-- Part/s Name Input Box Inside Option 3 -->
                        <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #f44336;">
                            <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 0.95em;">
                                {% if language == 'en' %}Part/s Name *{% else %}Nombre de la/s Pieza/s *{% endif %}
                            </label>
                            <input type="text" id="part_needed" required placeholder="{% if language == 'en' %}Front bumper, Headlight, Door...{% else %}Parachoques delantero, Faro, Puerta...{% endif %}"
                                   style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em;">
                            <small style="color: #666; display: block; margin-top: 8px;">
                                {% if language == 'en' %}
                                    üí° Enter your part name/s here. If using Option 1 above, paste exact names from pyp.com/prices
                                {% else %}
                                    üí° Ingresa el/los nombre/s de tu/s pieza/s aqu√≠. Si usas Opci√≥n 1 arriba, pega nombres exactos de pyp.com/prices
                                {% endif %}
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NEW: Upload Part Pictures -->
            <div class="form-group" style="background: #e3f2fd; padding: 20px; border-radius: 12px; border-left: 5px solid #2196f3;">
                <label style="font-weight: bold; font-size: 1.1em; color: #1565c0; margin-bottom: 10px; display: block;">
                    üì∏ {% if language == 'en' %}Upload Part Pictures (Optional){% else %}Subir Fotos de la Pieza (Opcional){% endif %}
                </label>
                <input type="file" id="part_images" multiple accept="image/*"
                       style="width: 100%; padding: 12px; border: 2px solid #2196f3; border-radius: 8px; background: white; cursor: pointer;">
                <small style="color: #1565c0; display: block; margin-top: 8px; font-weight: 600;">
                    {% if language == 'en' %}
                        üí° Upload pictures of the parts you need so I can identify them better! You can select multiple images.
                    {% else %}
                        üí° ¬°Sube fotos de las piezas que necesitas para que pueda identificarlas mejor! Puedes seleccionar m√∫ltiples im√°genes.
                    {% endif %}
                </small>
                <div id="image-preview" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;"></div>
            </div>

            <!-- Optional Notes Section -->
            <div class="form-group">
                <label>
                    {% if language == 'en' %}
                        Notes (Optional - but helps me find your part faster!)
                    {% else %}
                        Notas (Opcional - ¬°pero me ayuda a encontrar su pieza m√°s r√°pido!)
                    {% endif %}
                </label>
                <textarea id="additional_notes" rows="6" placeholder="{% if language == 'en' %}‚Ä¢ Other car compatibilities (e.g., also fits 2010-2015 Toyota Corolla)&#10;‚Ä¢ Where your car is located at Pick Your Parts (e.g., Sun Valley, Row 12)&#10;‚Ä¢ Any other details that could help...{% else %}‚Ä¢ Otras compatibilidades de autos (ej., tambi√©n sirve para Toyota Corolla 2010-2015)&#10;‚Ä¢ D√≥nde est√° su auto en Pick Your Parts (ej., Sun Valley, Fila 12)&#10;‚Ä¢ Cualquier otro detalle que pueda ayudar...{% endif %}"></textarea>
                <small style="color: #666; display: block; margin-top: 8px; font-style: italic;">
                    {% if language == 'en' %}
                        üí° <strong>Tip:</strong> If you know which junkyard has it, check <a href="https://pyp.com" target="_blank" style="color: #667eea; font-weight: bold;">pyp.com</a> and let me know the location and row!
                    {% else %}
                        üí° <strong>Consejo:</strong> Si sabes qu√© desarmadero lo tiene, revisa <a href="https://pyp.com" target="_blank" style="color: #667eea; font-weight: bold;">pyp.com</a> y d√©jame saber la ubicaci√≥n y fila!
                    {% endif %}
                </small>
            </div>

            <!-- Contact Info Banner - MOVED BELOW FILL FORM -->
            <div id="contact-info" style="background: #667eea; color: white; padding: 20px; border-radius: 12px; margin: 30px 0; text-align: center; border: 3px solid #5568d3;">
                <h3 style="font-size: 1.5em; margin-bottom: 10px; font-weight: 800;">
                    {% if language == 'en' %}üìû Prefer to text instead?{% else %}üìû ¬øPrefieres enviar mensaje de texto?{% endif %}
                </h3>
                <p style="font-size: 1.1em; margin-bottom: 10px;">
                    {% if language == 'en' %}Text me directly! Expect a slower response time.{% else %}¬°Env√≠ame mensaje directo! Espera un tiempo de respuesta m√°s lento.{% endif %}
                </p>
                <a href="sms:3235989389" style="display: inline-block; background: white; color: #667eea; padding: 15px 30px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 1.2em; margin-top: 10px;">
                    üì± (323) 598-9389
                </a>
                <p style="font-size: 0.9em; margin-top: 10px; opacity: 0.9;">
                    {% if language == 'en' %}(Phone number required for direct texts){% else %}(N√∫mero de tel√©fono requerido para mensajes directos){% endif %}
                </p>
            </div>

            <!-- PRICING FORMULA -->
            <div id="pricing-section" style="background: white; padding: 30px; border-radius: 12px; margin: 30px 0; border: 3px solid #667eea;">
                <h2 style="color: #667eea; margin-bottom: 20px; text-align: center; font-size: 1.8em;">
                    {% if language == 'en' %}üí∞ PRICING (FORMULA){% else %}üí∞ PRECIOS (F√ìRMULA){% endif %}
                </h2>

                <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; font-family: Arial; font-size: 1.05em; margin-bottom: 20px;">
                    <p style="font-weight: bold; font-size: 1.2em; margin-bottom: 15px; text-align: center; color: #667eea;">
                        {% if language == 'en' %}Total = Part Price + Labor + Travel + Delivery (if needed) + Warranty (optional){% else %}Total = Precio de la Pieza + Mano de Obra + Viaje + Entrega (si es necesario) + Garant√≠a (opcional){% endif %}
                    </p>

                    <ul style="margin-left: 20px; line-height: 2;">
                        {% if language == 'en' %}
                            <li><strong>Part price from junkyard</strong> (receipt shown)</li>
                            <li><strong>Labor:</strong> depends on size & difficulty <em>(can give more details if you text me!)</em></li>
                            <li><strong>Travel to yard:</strong> $10 flat</li>
                            <li><strong>Delivery (optional):</strong> $1.25 per mile from junkyard</li>
                            <li><strong>Warranty (optional):</strong> +30% of part price</li>
                            <li><strong>+$3 yard entry</strong></li>
                        {% else %}
                            <li><strong>Precio de la pieza del desarmadero</strong> (se muestra recibo)</li>
                            <li><strong>Mano de obra:</strong> depende del tama√±o y dificultad <em>(¬°puedo dar m√°s detalles si me env√≠as un mensaje de texto!)</em></li>
                            <li><strong>Viaje al desarmadero:</strong> $10 fijo</li>
                            <li><strong>Entrega (opcional):</strong> $1.25 por milla desde el desarmadero</li>
                            <li><strong>Garant√≠a (opcional):</strong> +30% del precio de la pieza</li>
                            <li><strong>+$3 entrada al desarmadero</strong></li>
                        {% endif %}
                    </ul>
                </div>
            </div>

            <!-- WARRANTY OPTION -->
            <div id="warranty-section" style="background: white; padding: 30px; border-radius: 12px; margin: 30px 0; border: 3px solid #e91e63;">
                <h2 style="color: #e91e63; margin-bottom: 15px; text-align: center; font-size: 1.8em;">
                    {% if language == 'en' %}üõ°Ô∏è WARRANTY (RECOMMENDED){% else %}üõ°Ô∏è GARANT√çA (RECOMENDADO){% endif %}
                </h2>

                <div style="background: #fce4ec; padding: 25px; border-radius: 8px;">
                    <p style="font-size: 1.2em; font-weight: bold; color: #c2185b; margin-bottom: 20px; text-align: center;">
                        {% if language == 'en' %}
                            +30% of part price only ‚Ä¢ 90 days from purchase
                        {% else %}
                            +30% del precio de la pieza solamente ‚Ä¢ 90 d√≠as desde la compra
                        {% endif %}
                    </p>

                    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <ul style="margin-left: 20px; line-height: 2; color: #555; font-size: 1.05em;">
                            {% if language == 'en' %}
                                <li>I buy it with warranty</li>
                                <li>I still send you pictures</li>
                                <li>You respond whenever, but I need confirmation (15-20 mins)</li>
                                <li>Ghost/decline? I return it</li>
                                <li>Valid for 90 days from day of purchase</li>
                            {% else %}
                                <li>La compro con garant√≠a</li>
                                <li>Todav√≠a te env√≠o fotos</li>
                                <li>Respondes cuando quieras, pero necesito confirmaci√≥n (15-20 mins)</li>
                                <li>¬øDesapareces/declinas? La devuelvo</li>
                                <li>V√°lido por 90 d√≠as desde el d√≠a de compra</li>
                            {% endif %}
                        </ul>
                    </div>

                    <!-- Warranty Checkbox -->
                    <div style="background: white; padding: 20px; border-radius: 8px; border: 3px solid #e91e63;">
                        <label style="display: flex; align-items: center; gap: 15px; cursor: pointer;">
                            <input type="checkbox" id="warranty_checkbox" style="width: 30px; height: 30px; cursor: pointer;">
                            <span style="font-size: 1.2em; font-weight: bold; color: #c2185b;">
                                {% if language == 'en' %}
                                    ‚úÖ Yes, I want warranty (+30% of part price)
                                {% else %}
                                    ‚úÖ S√≠, quiero garant√≠a (+30% del precio de pieza)
                                {% endif %}
                            </span>
                        </label>
                        <p style="margin-top: 15px; margin-left: 45px; color: #666; font-size: 0.95em; font-style: italic;">
                            {% if language == 'en' %}
                                ‚ö†Ô∏è Selecting this automatically chooses Option 1 for "Ways to Secure Your Part"
                            {% else %}
                                ‚ö†Ô∏è Seleccionar esto autom√°ticamente elige Opci√≥n 1 para "Formas de Asegurar Su Pieza"
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>

            <!-- WAYS TO SECURE YOUR PART -->
            <div id="secure-part-section" style="background: white; padding: 30px; border-radius: 12px; margin: 30px 0; border: 3px solid #28a745;">
                <h2 style="color: #28a745; margin-bottom: 10px; text-align: center; font-size: 1.8em;">
                    {% if language == 'en' %}üîí WAYS TO SECURE YOUR PART *{% else %}üîí FORMAS DE ASEGURAR SU PIEZA *{% endif %}
                </h2>
                <p style="text-align: center; color: #d84315; font-weight: bold; margin-bottom: 20px; font-size: 1.1em;">
                    {% if language == 'en' %}‚ö†Ô∏è You must select one option{% else %}‚ö†Ô∏è Debes seleccionar una opci√≥n{% endif %}
                </p>

                <!-- OPTION 1 - WARRANTY PURCHASE (RECOMMENDED) -->
                <label style="display: block; cursor: pointer; margin-bottom: 20px;">
                    <div style="background: #fce4ec; padding: 20px; border-radius: 8px; border-left: 5px solid #e91e63; transition: all 0.3s;">
                        <div style="display: flex; align-items: start; gap: 15px;">
                            <input type="radio" name="secure_method" id="secure_warranty" value="warranty" required style="width: 25px; height: 25px; margin-top: 5px; cursor: pointer;">
                            <div style="flex: 1;">
                                <h3 style="color: #c2185b; margin-bottom: 10px; font-size: 1.2em;">
                                    {% if language == 'en' %}OPTION 1 ‚Äì WARRANTY PURCHASE (recommended!) üî•{% else %}OPCI√ìN 1 ‚Äì COMPRA CON GARANT√çA (¬°recomendado!) üî•{% endif %}
                                </h3>
                                <ul style="margin-left: 20px; line-height: 1.8;">
                                    {% if language == 'en' %}
                                        <li>I buy it with warranty</li>
                                        <li>I still send you pictures</li>
                                        <li>You respond whenever, but I need confirmation (15-20 mins)</li>
                                        <li>Ghost/decline? I return it</li>
                                        <li><strong>+30% of part price</strong></li>
                                        <li><em style="color: #666;">Auto-selected if you choose warranty above</em></li>
                                    {% else %}
                                        <li>Lo compro con garant√≠a</li>
                                        <li>Todav√≠a te env√≠o fotos</li>
                                        <li>Respondes cuando quieras, pero necesito confirmaci√≥n (15-20 mins)</li>
                                        <li>¬øDesapareces/declinas? Lo devuelvo</li>
                                        <li><strong>+30% del precio de la pieza</strong></li>
                                        <li><em style="color: #666;">Auto-seleccionado si eliges garant√≠a arriba</em></li>
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </label>

                <!-- OPTION 2 - LIVE CONFIRMATION (REQUIRES FAST RESPONSE) -->
                <label style="display: block; cursor: pointer; margin-bottom: 20px;">
                    <div style="background: #fff3e0; padding: 20px; border-radius: 8px; border-left: 5px solid #ff9800; transition: all 0.3s;">
                        <div style="display: flex; align-items: start; gap: 15px;">
                            <input type="radio" name="secure_method" id="secure_live" value="live_confirmation" required style="width: 25px; height: 25px; margin-top: 5px; cursor: pointer;">
                            <div style="flex: 1;">
                                <h3 style="color: #f57c00; margin-bottom: 10px; font-size: 1.2em;">
                                    {% if language == 'en' %}OPTION 2 ‚Äì LIVE CONFIRMATION (fast response needed){% else %}OPCI√ìN 2 ‚Äì CONFIRMACI√ìN EN VIVO (respuesta r√°pida necesaria){% endif %}
                                </h3>
                                <ul style="margin-left: 20px; line-height: 1.8;">
                                    {% if language == 'en' %}
                                        <li>I send photos/videos from yard</li>
                                        <li>You confirm + deposit</li>
                                        <li>I pull it immediately</li>
                                    {% else %}
                                        <li>Env√≠o fotos/videos del desarmadero</li>
                                        <li>Confirmas + dep√≥sito</li>
                                        <li>Lo saco inmediatamente</li>
                                    {% endif %}
                                </ul>
                                <p style="margin-top: 10px; font-weight: bold; color: #d84315;">
                                    ‚è± {% if language == 'en' %}10-15 min to respond or I leave it{% else %}10-15 min para responder o lo dejo{% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                </label>

                <!-- OPTION 3 - DEPOSIT HOLD (REQUIRES TRUST) -->
                <label style="display: block; cursor: pointer;">
                    <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; border-left: 5px solid #28a745; transition: all 0.3s;">
                        <div style="display: flex; align-items: start; gap: 15px;">
                            <input type="radio" name="secure_method" id="secure_deposit" value="deposit_hold" required style="width: 25px; height: 25px; margin-top: 5px; cursor: pointer;">
                            <div style="flex: 1;">
                                <h3 style="color: #28a745; margin-bottom: 10px; font-size: 1.2em;">
                                    {% if language == 'en' %}OPTION 3 ‚Äì DEPOSIT HOLD (requires trust){% else %}OPCI√ìN 3 ‚Äì RETENCI√ìN CON DEP√ìSITO (requiere confianza){% endif %}
                                </h3>
                                <ul style="margin-left: 20px; line-height: 1.8;">
                                    {% if language == 'en' %}
                                        <li>Send deposit before I go</li>
                                        <li>I confirm with photos/video & pull it</li>
                                        <li>Refunded if not there</li>
                                        <li>Applied to total if approved</li>
                                    {% else %}
                                        <li>Env√≠a dep√≥sito antes de que vaya</li>
                                        <li>Confirmo con fotos/video y lo saco</li>
                                        <li>Reembolsado si no est√°</li>
                                        <li>Aplicado al total si apruebas</li>
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </label>
            </div>

            <!-- DEPOSITS -->
            <div style="background: white; padding: 30px; border-radius: 12px; margin: 30px 0; border: 3px solid #2196f3;">
                <h2 style="color: #2196f3; margin-bottom: 15px; text-align: center; font-size: 1.8em;">
                    {% if language == 'en' %}üíµ DEPOSITS{% else %}üíµ DEP√ìSITOS{% endif %}
                </h2>
                <p style="text-align: center; color: #666; font-size: 0.95em; margin-bottom: 20px;">
                    {% if language == 'en' %}(Applied to total / refunded if part NOT available){% else %}(Aplicado al total / reembolsado si la pieza NO est√° disponible){% endif %}
                </p>

                <div style="background: #e3f2fd; padding: 20px; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 15px; background: white; border-radius: 8px;">
                        <span style="font-weight: bold; font-size: 1.1em;">
                            {% if language == 'en' %}Small / Interior Parts:{% else %}Piezas Peque√±as / Interiores:{% endif %}
                        </span>
                        <span style="font-weight: bold; font-size: 1.3em; color: #2196f3;">$20</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: white; border-radius: 8px;">
                        <span style="font-weight: bold; font-size: 1.1em;">
                            {% if language == 'en' %}Large / Heavy / Exterior:{% else %}Grandes / Pesadas / Exteriores:{% endif %}
                        </span>
                        <span style="font-weight: bold; font-size: 1.3em; color: #2196f3;">$50</span>
                    </div>
                </div>
            </div>

            <!-- AVAILABILITY -->
            <div style="background: white; padding: 30px; border-radius: 12px; margin: 30px 0; border: 3px solid #9c27b0;">
                <h2 style="color: #9c27b0; margin-bottom: 15px; text-align: center; font-size: 1.8em;">
                    {% if language == 'en' %}‚è∞ AVAILABILITY / RESPONSE TIMES{% else %}‚è∞ DISPONIBILIDAD / TIEMPOS DE RESPUESTA{% endif %}
                </h2>

                <div style="background: #f3e5f5; padding: 20px; border-radius: 8px;">
                    <p style="margin-bottom: 15px; font-weight: bold; text-align: center; color: #9c27b0; font-size: 1.1em;">
                        {% if language == 'en' %}
                            I hit one yard per week
                        {% else %}
                            Visito un desarmadero por semana
                        {% endif %}
                    </p>

                    <ul style="margin-left: 20px; line-height: 2; font-size: 1.05em;">
                        {% if language == 'en' %}
                            <li><strong>In the yard:</strong> 9:00 AM ‚Äì ~1:00 PM (limited replies)</li>
                            <li><strong>Responding after:</strong> 4:00 PM</li>
                            <li><strong>No replies after:</strong> 9:00 PM</li>
                        {% else %}
                            <li><strong>En el desarmadero:</strong> 9:00 AM ‚Äì ~1:00 PM (respuestas limitadas)</li>
                            <li><strong>Respondiendo despu√©s de:</strong> 4:00 PM</li>
                            <li><strong>Sin respuestas despu√©s de:</strong> 9:00 PM</li>
                        {% endif %}
                    </ul>

                    <p style="margin-top: 20px; font-weight: bold; text-align: center; color: #7b1fa2; font-size: 1.1em;">
                        {% if language == 'en' %}
                            Photos/videos always sent before purchase.<br>
                            If I don't reply, I'm inside the yard.
                        {% else %}
                            Fotos/videos siempre enviados antes de la compra.<br>
                            Si no respondo, estoy dentro del desarmadero.
                        {% endif %}
                    </p>
                </div>
            </div>

            <!-- Confirmation Message -->
            <div id="submit-section" style="background: #667eea; color: white; padding: 20px; border-radius: 12px; text-align: center; margin-top: 30px; border: 3px solid #5568d3;">
                <p style="font-size: 1.2em; font-weight: bold; margin-bottom: 10px;">
                    {% if language == 'en' %}
                        üì¨ Once submitted, I'll message you from:
                    {% else %}
                        üì¨ Una vez enviado, te enviar√© mensaje desde:
                    {% endif %}
                </p>
                <p style="font-size: 1.5em; font-weight: 800;">
                    üì± (323) 598-9389
                </p>
            </div>

            <button type="submit" class="submit-btn">
                {% if language == 'en' %}üì§ Submit Request{% else %}üì§ Enviar Solicitud{% endif %}
            </button>
        </form>

        <div class="back-link">
            <a href="/">{% if language == 'en' %}‚Üê Change Language{% else %}‚Üê Cambiar Idioma{% endif %}</a>
        </div>
    </div>

    <!-- Scroll Indicator -->
    <div class="scroll-indicator" id="scrollIndicator" onclick="scrollDown()">
        {% if language == 'en' %}
            ‚¨áÔ∏è Keep scrolling to fill out the form
        {% else %}
            ‚¨áÔ∏è Sigue bajando para llenar el formulario
        {% endif %}
    </div>

    <script>
        const language = "{{ language }}";

        // Selected junkyard parts storage
        let selectedJunkyardParts = [];

        // Junkyard part search functionality
        let searchTimeout;
        async function searchJunkyardParts(query) {
            clearTimeout(searchTimeout);

            if (query.length < 2) {
                document.getElementById('junkyard-suggestions').style.display = 'none';
                return;
            }

            searchTimeout = setTimeout(async () => {
                try {
                    const response = await fetch(`/search_junkyard_parts?q=${encodeURIComponent(query)}`);
                    const data = await response.json();

                    if (data.success && data.parts.length > 0) {
                        displayJunkyardSuggestions(data.parts);
                    } else {
                        document.getElementById('junkyard-suggestions').innerHTML =
                            `<div style="padding: 15px; text-align: center; color: #999;">
                                ${language === 'en' ? 'No parts found' : 'No se encontraron piezas'}
                            </div>`;
                        document.getElementById('junkyard-suggestions').style.display = 'block';
                    }
                } catch (error) {
                    console.error('Error searching parts:', error);
                }
            }, 300);
        }

        function displayJunkyardSuggestions(parts) {
            const suggestionsDiv = document.getElementById('junkyard-suggestions');
            suggestionsDiv.innerHTML = '';

            parts.forEach(part => {
                const partDiv = document.createElement('div');
                partDiv.style.cssText = 'padding: 12px; border-bottom: 1px solid #e0e0e0; cursor: pointer; transition: background 0.2s;';
                partDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 600;">${part.name}</span>
                        <span style="color: #28a745; font-weight: bold;">$${part.price.toFixed(2)}</span>
                    </div>
                `;

                partDiv.onmouseover = () => partDiv.style.background = '#f0f9ff';
                partDiv.onmouseout = () => partDiv.style.background = 'white';
                partDiv.onclick = () => addJunkyardPart(part);

                suggestionsDiv.appendChild(partDiv);
            });

            suggestionsDiv.style.display = 'block';
        }

        function addJunkyardPart(part) {
            // Check if part already selected
            if (selectedJunkyardParts.find(p => p.name === part.name)) {
                return;
            }

            selectedJunkyardParts.push({ ...part, qty: 1 });
            updateSelectedPartsDisplay();

            // Clear search
            document.getElementById('junkyard-search').value = '';
            document.getElementById('junkyard-suggestions').style.display = 'none';
        }

        function removeJunkyardPart(partName) {
            selectedJunkyardParts = selectedJunkyardParts.filter(p => p.name !== partName);
            updateSelectedPartsDisplay();
        }

        function updatePartQuantity(partName, qty) {
            const part = selectedJunkyardParts.find(p => p.name === partName);
            if (part) {
                part.qty = parseInt(qty) || 1;
                updateSelectedPartsDisplay();
            }
        }

        function updateSelectedPartsDisplay() {
            const container = document.getElementById('selected-junkyard-parts');

            if (selectedJunkyardParts.length === 0) {
                container.innerHTML = '';
                return;
            }

            let subtotal = selectedJunkyardParts.reduce((sum, part) => sum + (part.price * part.qty), 0);
            let tax = subtotal * 0.0975; // 9.75% tax
            let totalWithTax = subtotal + tax;

            container.innerHTML = `
                <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; border: 2px solid #28a745;">
                    <h4 style="color: #28a745; margin-bottom: 10px; font-size: 1.1em;">
                        ${language === 'en' ? '‚úÖ Selected Parts' : '‚úÖ Piezas Seleccionadas'}
                    </h4>
                    ${selectedJunkyardParts.map(part => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: white; border-radius: 6px; margin-bottom: 8px;">
                            <div style="flex: 1;">
                                <strong>${part.name}</strong><br>
                                <small style="color: #666;">$${part.price.toFixed(2)} ${language === 'en' ? 'each' : 'c/u'}</small>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div>
                                    <label style="font-size: 0.85em; color: #666; margin-bottom: 2px; display: block;">
                                        ${language === 'en' ? 'Qty' : 'Cant'}:
                                    </label>
                                    <input type="number" min="1" value="${part.qty}"
                                           onchange="updatePartQuantity('${part.name}', this.value)"
                                           style="width: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: bold; color: #28a745;">$${(part.price * part.qty).toFixed(2)}</div>
                                    <button onclick="removeJunkyardPart('${part.name}')"
                                            style="background: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.85em; margin-top: 5px;">
                                        ${language === 'en' ? 'Remove' : 'Eliminar'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                    <div style="border-top: 2px solid #28a745; margin-top: 10px; padding-top: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #666;">${language === 'en' ? 'Subtotal:' : 'Subtotal:'}</span>
                            <span style="font-weight: bold;">$${subtotal.toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #666;">${language === 'en' ? 'Tax (9.75%):' : 'Impuesto (9.75%):'}</span>
                            <span style="font-weight: bold;">$${tax.toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; border-top: 2px solid #28a745; padding-top: 8px;">
                            <strong style="font-size: 1.2em; color: #28a745;">
                                ${language === 'en' ? 'Total (w/ tax):' : 'Total (c/ impuesto):'}
                            </strong>
                            <strong style="font-size: 1.2em; color: #28a745;">
                                $${totalWithTax.toFixed(2)}
                            </strong>
                        </div>
                        <p style="font-size: 0.8em; color: #666; margin-top: 10px; font-style: italic; text-align: center;">
                            ${language === 'en' ? 'üí° Prices from pyp.com/prices' : 'üí° Precios de pyp.com/prices'}
                        </p>
                    </div>
                </div>
            `;
        }

        // Image preview functionality
        document.getElementById('part_images').addEventListener('change', function(e) {
            const previewContainer = document.getElementById('image-preview');
            previewContainer.innerHTML = '';

            const files = Array.from(e.target.files);

            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgDiv = document.createElement('div');
                    imgDiv.style.cssText = 'position: relative;';
                    imgDiv.innerHTML = `
                        <img src="${e.target.result}"
                             style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; border: 2px solid #2196f3;">
                        <div style="position: absolute; top: -5px; right: -5px; background: #f44336; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: bold;"
                             onclick="removeImage(${index})">√ó</div>
                    `;
                    previewContainer.appendChild(imgDiv);
                };
                reader.readAsDataURL(file);
            });
        });

        function removeImage(index) {
            const fileInput = document.getElementById('part_images');
            const dt = new DataTransfer();
            const files = Array.from(fileInput.files);

            files.forEach((file, i) => {
                if (i !== index) {
                    dt.items.add(file);
                }
            });

            fileInput.files = dt.files;
            fileInput.dispatchEvent(new Event('change'));
        }

        // Smooth scroll to section
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Scroll down smoothly
        function scrollDown() {
            window.scrollBy({
                top: window.innerHeight * 0.8,
                behavior: 'smooth'
            });
        }

        // Hide/show table of contents and scroll indicator
        let lastScrollTop = 0;
        const toc = document.getElementById('toc');
        const scrollIndicator = document.getElementById('scrollIndicator');
        const submitButton = document.querySelector('.submit-btn');

        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            const submitButtonRect = submitButton.getBoundingClientRect();
            const submitButtonVisible = submitButtonRect.top < windowHeight && submitButtonRect.bottom >= 0;

            // Hide TOC when scrolling down and near/past submit button, show when scrolling up
            if (submitButtonVisible || scrollTop > lastScrollTop + 50) {
                toc.classList.add('hidden');
            } else if (scrollTop < lastScrollTop - 50) {
                toc.classList.remove('hidden');
            }

            // Hide scroll indicator only when user reaches the bottom
            const nearBottom = scrollTop + windowHeight >= documentHeight - 50;

            if (nearBottom) {
                scrollIndicator.classList.add('hidden');
            } else {
                scrollIndicator.classList.remove('hidden');
            }

            lastScrollTop = scrollTop;
        });

        // Auto-select Option 1 when warranty is checked
        document.getElementById('warranty_checkbox').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('secure_warranty').checked = true;
            }
        });

        // Form submission
        document.getElementById('requestForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Get selected secure method
            const secureMethod = document.querySelector('input[name="secure_method"]:checked');
            if (!secureMethod) {
                alert(language === 'en' ? 'Please select a way to secure your part.' : 'Por favor selecciona una forma de asegurar tu pieza.');
                return;
            }

            // Create FormData for file upload support
            const formData = new FormData();
            formData.append('customer_name', document.getElementById('customer_name').value);
            formData.append('customer_phone', document.getElementById('customer_phone').value);
            formData.append('vehicle_year', document.getElementById('vehicle_year').value);
            formData.append('vehicle_make', document.getElementById('vehicle_make').value);
            formData.append('vehicle_model', document.getElementById('vehicle_model').value);
            formData.append('vehicle_color', document.getElementById('vehicle_color').value);
            formData.append('color_doesnt_matter', document.getElementById('color_doesnt_matter').checked);
            formData.append('part_needed', document.getElementById('part_needed').value);
            formData.append('additional_notes', document.getElementById('additional_notes').value);
            formData.append('secure_method', secureMethod.value);
            formData.append('warranty', document.getElementById('warranty_checkbox').checked);
            formData.append('language', language);

            // Add junkyard parts data
            formData.append('junkyard_parts', JSON.stringify(selectedJunkyardParts));

            // Add image files
            const imageFiles = document.getElementById('part_images').files;
            for (let i = 0; i < imageFiles.length; i++) {
                formData.append('part_images[]', imageFiles[i]);
            }

            try {
                const response = await fetch('/submit_request', {
                    method: 'POST',
                    body: formData
                    // Don't set Content-Type header - browser will set it automatically with boundary for multipart/form-data
                });

                const data = await response.json();

                if (data.success) {
                    window.location.href = '/thank_you?lang=' + language;
                } else {
                    alert(language === 'en' ? 'Error submitting request. Please try again.' : 'Error al enviar la solicitud. Por favor, int√©ntelo de nuevo.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert(language === 'en' ? 'Error submitting request. Please try again.' : 'Error al enviar la solicitud. Por favor, int√©ntelo de nuevo.');
            }
        });
    </script>
</body>
</html>
